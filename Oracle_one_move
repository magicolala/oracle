from dataclasses import replace

from oracle.config import Settings, load_settings, resolve_value
from oracle.interfaces.cli.single_move import run_single_move_cli

OPENAI_API_KEY = ""
STOCKFISH_PATH = ""
MODEL_NAME = "gpt-3.5-turbo-instruct"
DEPTH = 5
PROB_THRESHOLD = 0.001


def _apply_overrides(settings: Settings) -> Settings:
    return replace(
        settings,
        openai_api_key=resolve_value(OPENAI_API_KEY, settings.openai_api_key),
        stockfish_path=resolve_value(STOCKFISH_PATH, settings.stockfish_path),
        model_name=resolve_value(MODEL_NAME, settings.model_name),
    )


if __name__ == "__main__":
    settings = _apply_overrides(load_settings())
    run_single_move_cli(settings, depth=DEPTH, prob_threshold=PROB_THRESHOLD)
